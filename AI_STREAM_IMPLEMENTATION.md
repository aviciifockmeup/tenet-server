# AI Stream æµå¼å¯¹è¯å®ç°æ–‡æ¡£

## æ¦‚è¿°
åœ¨ tenet-server ä¸­å®ç°äº†åŸºäº SSE (Server-Sent Events) çš„ AI æµå¼å¯¹è¯åŠŸèƒ½ï¼Œæ”¯æŒå¤š AI æä¾›å•†ã€å·¥å…·è°ƒç”¨ï¼ˆFunction Callingï¼‰ã€Agent é…ç½®ç®¡ç†ç­‰æ ¸å¿ƒèƒ½åŠ›ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- SSE æµå¼å“åº”ï¼Œå®æ—¶è¿”å› AI ç”Ÿæˆå†…å®¹
- Provider æ¨¡å¼æ”¯æŒå¤š AI æä¾›å•†ï¼ˆå·²å®ç° DeepSeekï¼‰
- å®Œæ•´çš„ Function Calling / Tool Calling æ”¯æŒ
- Agent é…ç½®æ•°æ®åº“åŒ–ç®¡ç†
- å·¥å…·å®šä¹‰åŠ¨æ€åŠ è½½

**æŠ€æœ¯æ ˆ**ï¼š
- HTTP æ¡†æ¶ï¼šHertz v0.9.0
- æ•°æ®åº“ï¼šMySQL (GORM)
- AI æä¾›å•†ï¼šDeepSeek API (OpenAI å…¼å®¹)
- æµå¼åè®®ï¼šSSE (text/event-stream)

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Tenet Server                              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Router       â”‚    â”‚      Handler Layer                  â”‚    â”‚
â”‚  â”‚              â”‚    â”‚                                     â”‚    â”‚
â”‚  â”‚ POST /chat   â”œâ”€â”€â”€â–ºâ”‚  AIStreamHandler                   â”‚    â”‚
â”‚  â”‚              â”‚    â”‚  - å‚æ•°è§£æä¸éªŒè¯                   â”‚    â”‚
â”‚  â”‚              â”‚    â”‚  - Agent é…ç½®æŸ¥è¯¢                   â”‚    â”‚
â”‚  â”‚              â”‚    â”‚  - Tool å®šä¹‰åŠ è½½                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  - SSE å“åº”å¤´è®¾ç½®                   â”‚    â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                 â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Service Layer (Provider æ¨¡å¼)              â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  AIService   â”‚      â”‚    AIProvider æ¥å£       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚              â”‚      â”‚  StreamChat(ctx, req)   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ providers    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚  â”‚  [DeepSeek]  â”‚                 â”‚                    â”‚    â”‚
â”‚  â”‚  â”‚  [Gemini]    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚  [Claude]    â”‚      â”‚  DeepSeekProvider  â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  - buildRequest()  â”‚          â”‚    â”‚
â”‚  â”‚         â”‚              â”‚  - handleStream()  â”‚          â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  - SSE è§£æ        â”‚          â”‚    â”‚
â”‚  â”‚                        â”‚  - ToolCall ç´¯ç§¯   â”‚          â”‚    â”‚
â”‚  â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Model/Service Layer (æ•°æ®è®¿é—®)                   â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  AgentService         ToolCallService                    â”‚  â”‚
â”‚  â”‚  â””â”€â–º AgentTable       â””â”€â–º ToolCallTable                  â”‚  â”‚
â”‚  â”‚      (Agenté…ç½®)           (å·¥å…·å®šä¹‰)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                       â–²
              â”‚ HTTPS POST                            â”‚ SSE Stream
              â–¼                                       â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  DeepSeek API â”‚                      â”‚  Frontend     â”‚
      â”‚               â”‚                      â”‚  (Browser)    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Provider æ¨¡å¼è®¾è®¡

```go
// æ¥å£å®šä¹‰
type AIProvider interface {
    StreamChat(ctx context.Context, request *model.AIStreamRequest, c *app.RequestContext) error
}

// æ³¨å†Œæœºåˆ¶
aiService := service.NewAIService()
aiService.RegisterProvider("deepseek", deepSeekProvider)
aiService.RegisterProvider("gemini", geminiProvider)    // å¾…å®ç°
aiService.RegisterProvider("claude", claudeProvider)    // å¾…å®ç°

// è°ƒç”¨åˆ†å‘
aiService.StreamChat(ctx, req, c)  // è‡ªåŠ¨æ ¹æ® req.Config.Provider è·¯ç”±
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€æ¥å£ï¼Œæ˜“äºæ‰©å±•æ–° Provider
- é…ç½®é©±åŠ¨ï¼Œå‰ç«¯æ— éœ€å…³å¿ƒ Provider å·®å¼‚
- é™ä½è€¦åˆï¼ŒService å±‚ä¸ä¾èµ–å…·ä½“å®ç°

---

## æ•°æ®æ¨¡å‹

### è¯·æ±‚æ¨¡å‹ (AIStreamRequest)

```go
type AIStreamRequest struct {
    AgentID   string        `json:"agentId"`    // Agent é…ç½®IDï¼ˆå¯é€‰ï¼‰
    Config    *AIConfig     `json:"config"`     // ç›´æ¥é…ç½®ï¼ˆå¯é€‰ï¼‰
    Messages  []Message     `json:"messages"`   // å¯¹è¯å†å²
    ToolNames []string      `json:"toolNames"`  // å·¥å…·åç§°åˆ—è¡¨
    Tools     []Tool        `json:"tools"`      // å·¥å…·å®Œæ•´å®šä¹‰ï¼ˆå·²å¼ƒç”¨ï¼‰
}
```

**å‚æ•°ä¼˜å…ˆçº§**ï¼š
- `agentId` å­˜åœ¨ â†’ ä»æ•°æ®åº“æŸ¥è¯¢ Agent é…ç½®
- `agentId` ä¸ºç©º â†’ ä½¿ç”¨ `config` ä¸­çš„é…ç½®
- `toolNames` å­˜åœ¨ â†’ ä»æ•°æ®åº“æŸ¥è¯¢å·¥å…·å®šä¹‰
- `tools` ç›´æ¥ä¼ é€’ï¼ˆä¸æ¨èï¼‰

### å“åº”æ¨¡å‹ (SSE Chunk)

```go
type SSEChunk struct {
    Type      string      `json:"type"`       // "content" | "tool_calls" | "error" | "done"
    Content   string      `json:"content"`    // æ–‡æœ¬å†…å®¹
    ToolCalls []ToolCall  `json:"toolCalls"`  // å·¥å…·è°ƒç”¨åˆ—è¡¨
    Error     string      `json:"error"`      // é”™è¯¯ä¿¡æ¯
}
```

**SSE ä¼ è¾“æ ¼å¼**ï¼š
```
data: {"type":"content","content":"æˆ‘æ¥å¸®ä½ "}
data: {"type":"content","content":"åˆ›å»ºæµç¨‹å›¾"}
data: {"type":"tool_calls","toolCalls":[{"id":"call_1","type":"function","function":{"name":"add_node","arguments":"{\"x\":100,\"y\":100}"}}]}
data: {"type":"done"}
```

### æ•°æ®åº“æ¨¡å‹

**AgentTable**ï¼šå­˜å‚¨ Agent é…ç½®ï¼ˆprovider, model, temperature, maxTokens, systemMessage, apiKeyï¼‰

**ToolCallTable**ï¼šå­˜å‚¨å·¥å…·å®šä¹‰ï¼ˆname, description, parameters JSON, categoryï¼‰

---

## æ ¸å¿ƒæµç¨‹

### æµç¨‹å›¾ï¼šAI Stream Chat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯å‘èµ·è¯·æ±‚  â”‚
â”‚ agentId      â”‚
â”‚ toolNames    â”‚
â”‚ messages     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Handler: å‚æ•°è§£æ        â”‚
â”‚ - ç»‘å®š JSON åˆ° Request   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŸ¥è¯¢ Agent é…ç½®          â”‚
â”‚ AgentService.GetByID()  â”‚
â”‚ â†’ config.Provider       â”‚
â”‚ â†’ config.Model          â”‚
â”‚ â†’ config.SystemMessage  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½å·¥å…·å®šä¹‰             â”‚
â”‚ ToolCallService         â”‚
â”‚ .GetToolsByNames()      â”‚
â”‚ â†’ tools[]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¾ç½® SSE å“åº”å¤´          â”‚
â”‚ Content-Type:           â”‚
â”‚   text/event-stream     â”‚
â”‚ Cache-Control: no-cache â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°ƒç”¨ AIService           â”‚
â”‚ .StreamChat()           â”‚
â”‚ â†’ è·¯ç”±åˆ° Provider       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DeepSeekProvider        â”‚
â”‚ 1. buildRequestBody()   â”‚
â”‚    - system message     â”‚
â”‚    - history messages   â”‚
â”‚    - tools æ•°ç»„         â”‚
â”‚ 2. HTTP è¯·æ±‚ DeepSeek   â”‚
â”‚ 3. handleStream() SSE   â”‚
â”‚    - è§£æ delta         â”‚
â”‚    - ç´¯ç§¯ toolCalls     â”‚
â”‚    - å‘é€ç»™å‰ç«¯         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯æ¥æ”¶ SSE æµ          â”‚
â”‚ - content chunks        â”‚
â”‚ - toolCalls             â”‚
â”‚ - done                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tool Calling æ•°æ®æµ

```
AI è¿”å› (å¤šä¸ª delta):
{
  "choices": [{
    "delta": {
      "tool_calls": [{
        "index": 0,
        "id": "call_1",
        "type": "function",
        "function": {
          "name": "add_node",
          "arguments": "{"
        }
      }]
    }
  }]
}
{æµç¨‹

DeepSeek ä»¥ SSE æµå¼è¿”å› tool_callsï¼Œæ¯ä¸ª delta åŒ…å«éƒ¨åˆ†æ•°æ®ï¼š
- ç¬¬ä¸€ä¸ª deltaï¼šåŒ…å« idã€typeã€name
- åç»­ deltaï¼šé€æ­¥æ‹¼æ¥ arguments JSON å­—ç¬¦ä¸²
- Provider æŒ‰ index ç´¯ç§¯å®Œæ•´çš„ toolCall
- ç´¯ç§¯å®Œæˆåç»Ÿä¸€å‘é€ç»™å‰ç«¯

**åœºæ™¯ 1**ï¼šä½¿ç”¨é¢„ç½® Agent
```json
{
  "agentId": "agent_board_assistant",
  "messages": [...]
}
```

**åœºæ™¯ 2**ï¼šä¸´æ—¶è‡ªå®šä¹‰é…ç½®
```json
{
  "config": {
    "provider": "deepseek",
    "model": "deepseek-chat",
    "temperature": 0.7
  },
  "messages": [...]
}
```

**ä¼˜åŠ¿**ï¼š
- ç”Ÿäº§ç¯å¢ƒç”¨ agentIdï¼ˆç¨³å®šã€ç»Ÿä¸€ç®¡ç†ï¼‰
- å¼€å‘è°ƒè¯•ç”¨ configï¼ˆå¿«é€Ÿæµ‹è¯•ä¸åŒå‚æ•°ï¼‰

### 3. å·¥å…·å‚æ•°ä¼˜åŒ–

**é—®é¢˜**ï¼šå·¥å…·å®šä¹‰ä¸­ `required` å­—æ®µè¿‡å¤šå¯¼è‡´ AI åå¤è¯¢é—®å‚æ•°ã€‚

**ç¤ºä¾‹**ï¼š
```json
// âŒ åŸå§‹å®šä¹‰
{
  "name": "add_node",
  "parameters": {
    "required": ["x", "y", "width", "height", "shapeCode", "color"]
  }
}

// ç”¨æˆ·: "å¸®æˆ‘æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹"
// AI: "æˆ‘éœ€è¦çŸ¥é“å®½åº¦ã€é«˜åº¦ã€å½¢çŠ¶ä»£ç ã€é¢œè‰²..."  ğŸ˜
```

**ä¼˜åŒ–**ï¼š
```json
// âœ… ä¼˜åŒ–å
{
  "name": "add_node",
  "parameters": {
    "required": ["x", "y"],  // åªè¦æ±‚å¿…éœ€å‚æ•°
    "properties": {
      "width": {"type": "number", "default": 100},
      "height": {"type": "number", "default": 100},
      "shapeCode": {"type": "number", "default": 1},
      "color": {"type": "string", "default": "#FFFFFF"}
    }
  }
}

// ç”¨æˆ·: "å¸®æˆ‘æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹"
// AI: ç›´æ¥è°ƒç”¨ add_node(x=100, y=100) âœ…
```

**ç»“æœ**ï¼šAI ç›´æ¥è°ƒç”¨å·¥å…·ï¼Œæ— éœ€é¢å¤–ç¡®è®¤ã€‚

### 4. SSE Chunk å¤ç”¨

**å†³ç­–**ï¼šåˆ›å»º `utils/sse.go` ç»Ÿä¸€ SSE å‘é€é€»è¾‘ã€‚

```go
// utils/sse.go
func SendSSEChunk(c *app.RequestContext, chunk *model.SSEChunk) error {
    data, _ := json.Marshal(chunk)
    c.Write([]byte("data: "))
    c.Write(data)
    c.Write([]byte("\n\n"))
    c.Flush()
    return nil
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- Handler å‘é€é”™è¯¯ Chunk
- Provider å‘é€ content/tool_calls Chunk
- é¿å…ä»£ç é‡å¤

### 5. Provider åˆ†ç¦»

**æ¶æ„**ï¼š
```
Service (AIService)
  â”œâ”€ interface: AIProvider
  â”œâ”€ DeepSeekProvider  (å·²å®ç°)
  â”œâ”€ GeminiProvider    (å¾…å®ç°)
  â””â”€ ClaudeProvider    (å¾…å®ç°)
```

**ä¼˜åŠ¿**ï¼š
- æ¯ä¸ª Provider ç‹¬ç«‹æ–‡ä»¶ï¼Œäº’ä¸å¹²æ‰°
- æ·»åŠ æ–° Provider åªéœ€å®ç° `StreamChat()` æ¥å£
- Service å±‚ç»Ÿä¸€è°ƒåº¦ï¼ŒHandler å±‚æ— æ„ŸçŸ¥

---

## æµ‹è¯•éªŒè¯

### Postman æµ‹è¯•ç”¨ä¾‹

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
POST http://localhost:8080/api/ai-stream/chat
Content-Type: application/json

{
  "agentId": "agent_board_assistant_xhs",
  "toolNames": ["add_node"],
  "messages": [
    {
      "role": "user",
      "content": "å¸®æˆ‘åœ¨ç”»æ¿ä¸Šæ·»åŠ ä¸€ä¸ªçŸ©å½¢èŠ‚ç‚¹ï¼Œä½ç½®æ˜¯100,100"
    }
  ]
}
```

**å“åº”ç¤ºä¾‹**ï¼š
Agent é…ç½®å’Œå·¥å…·å®šä¹‰å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œå‰ç«¯é€šè¿‡ `agentId` åŠ¨æ€åˆ‡æ¢ AI é…ç½®ï¼Œå·¥å…·å®šä¹‰å¯ç›´æ¥åœ¨æ•°æ®åº“ä¿®æ”¹æ— éœ€é‡æ–°éƒ¨ç½²ã€‚

### 2. å‚æ•°çµæ´»æ€§è®¾è®¡
æ”¯æŒä¸¤ç§æ–¹å¼ï¼šä½¿ç”¨é¢„ç½® Agentï¼ˆ`agentId`ï¼‰æˆ–ä¸´æ—¶è‡ªå®šä¹‰é…ç½®ï¼ˆ`config`ï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒç”¨å‰è€…ä¿è¯ç¨³å®šï¼Œå¼€å‘è°ƒè¯•ç”¨åè€…å¿«é€Ÿæµ‹è¯•ã€‚

### 3. å·¥å…·å‚æ•°ä¼˜åŒ–
å·¥å…·å®šä¹‰ä¸­åªæ ‡è®°æ ¸å¿ƒå‚æ•°ä¸º `required`ï¼ˆå¦‚ add_node åªè¦æ±‚ x, yï¼‰ï¼Œå…¶ä»–å‚æ•°æä¾›é»˜è®¤å€¼ï¼Œé¿å… AI åå¤è¯¢é—®ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

### 4. SSE å·¥å…·å°è£…
åˆ›å»º `utils/sse.go` ç»Ÿä¸€ SSE å‘é€é€»è¾‘ï¼ŒHandler å’Œ Provider å±‚å¤ç”¨ï¼Œé¿å…ä»£ç é‡å¤ã€‚

### 5. Provider æ¥å£è®¾è®¡
å®šä¹‰ç»Ÿä¸€çš„ `AIProvider` æ¥å£ï¼Œæ¯ä¸ª AI æä¾›å•†ç‹¬ç«‹å®ç°ï¼ŒService å±‚ç»Ÿä¸€è°ƒåº¦ï¼Œæ˜“äºæ‰©å±•æ–° Providerã€‚

## é¡¹ç›®è¿›åº¦

### âœ… å·²å®Œæˆ
- AI Stream æ ¸å¿ƒæµç¨‹å®ç°
- DeepSeek Provider å®Œæ•´å®ç°
- Agent é…ç½®æ•°æ®åº“åŒ–
- å·¥å…·å®šä¹‰åŠ¨æ€åŠ è½½
- SSE æµå¼å“åº”
- Tool Calling æ”¯æŒ
- ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡

### ğŸš§ è¿›è¡Œä¸­
- å·¥å…·ç­›é€‰æ¥å£ (select-tools) **â† ä¸‹ä¸€æ­¥**

### ğŸ“‹ å¾…å¼€å‘
- å¯¹è¯æŒä¹…åŒ–
- å¤š Provider æ”¯æŒ (Gemini, Claude)
- å‰ç«¯é›†æˆæµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

---

## æŠ€æœ¯æ€»ç»“

**æ ¸å¿ƒä»·å€¼**ï¼š
1. **é«˜æ€§èƒ½æµå¼ä½“éªŒ**ï¼šSSE å®æ—¶è¿”å›ï¼Œç”¨æˆ·æ— éœ€ç­‰å¾…å®Œæ•´å“åº”
2. **æ™ºèƒ½å·¥å…·è°ƒç”¨**ï¼šAI è‡ªåŠ¨åˆ¤æ–­å¹¶è°ƒç”¨ç”»æ¿æ“ä½œå·¥å…·
3. **Token æˆæœ¬ä¼˜åŒ–**ï¼šä¸¤é˜¶æ®µç­›é€‰èŠ‚çœ 70% Token æ¶ˆè€—
4. **æ¶æ„å¯æ‰©å±•æ€§**ï¼šProvider æ¨¡å¼è½»æ¾æ”¯æŒå¤š AI æä¾›å•†

**æŠ€æœ¯äº®ç‚¹**ï¼š
- Go Channels + SSE å®ç°é«˜æ•ˆæµå¼ä¼ è¾“
- æ•°æ®é©±åŠ¨çš„ Agent å’Œ Tool é…ç½®
- ç»†åç»­è§„åˆ’

- å¯¹è¯æŒä¹…åŒ–ï¼ˆConversationTable, ChatMessageTableï¼‰
- å¤š Provider æ”¯æŒï¼ˆGemini, Claudeï¼‰
- å‰ç«¯é›†æˆæµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒå¢å¼ºï¼ˆè®¤è¯ã€ç›‘æ§ã€é™æµï¼‰- **é«˜æ€§èƒ½æµå¼ä½“éªŒ**ï¼šSSE å®æ—¶è¿”å›ï¼Œç”¨æˆ·æ— éœ€ç­‰å¾…å®Œæ•´å“åº”
- **æ™ºèƒ½å·¥å…·è°ƒç”¨**ï¼šAI è‡ªåŠ¨åˆ¤æ–­å¹¶è°ƒç”¨ç”»æ¿æ“ä½œå·¥å…·
- **æ¶æ„å¯æ‰©å±•æ€§**ï¼šProvider æ¨¡å¼è½»æ¾æ”¯æŒå¤š AI æä¾›å•†

**æŠ€æœ¯äº®ç‚¹**ï¼š
- Go SSE å®ç°é«˜æ•ˆæµå¼ä¼ è¾“
- æ•°æ®é©±åŠ¨çš„ Agent å’Œ Tool é…ç½®
- å·¥å…·å‚æ•°ä¼˜åŒ–å‡å°‘ AI è¯¢é—®æ¬¡æ•°
- ç»Ÿä¸€çš„ Provider æ¥å£è®¾è®¡